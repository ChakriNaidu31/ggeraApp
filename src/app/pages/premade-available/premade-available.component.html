<app-header></app-header>
<main class="body-height">
    <div class="rounded text-body-emphasis">
        <div class="col-lg-12 col-xs-12">
            <div class="hero-bg">
                <div class="hero-sec mb-4 p-4 rounded text-body-emphasis container">

                    <div class="mb-4 mt-5 p-4 rounded text-body-emphasis session-text">
                        <h1 class="text-white">Join Premade Parties</h1>
                        <p class="text-white mt-3">
                            Join a Lobby, play with the pros, and experience the game your way.
                        </p>
                    </div>

                    <div class="mt-5">
                        <div
                            class="d-flex align-items-center justify-content-between p-3 rounde12 bg-darks text-light mb-5">
                            <form [formGroup]="form">
                                <div class="d-flex">
                                    <div class="me-2">
                                        <select class="form-select custom-select" aria-label="Select option"
                                            formControlName="gameId" (change)="getData()">
                                            <option value="">All Games</option>
                                            <option *ngFor="let game of games" value="{{game.id}}">{{game.title}}
                                            </option>
                                        </select>
                                    </div>
                                </div>
                            </form>
                        </div>

                        <div class="premade-parties-wrapper d-flex text-white"
                            *ngIf="selectedItems.length === 0">
                            No premade parties or streams available
                        </div>
                    </div>

                    <ng-container *ngIf="selectedItems.length > 0">
                        <div class="mt-5" *ngFor="let item of selectedItems; let i = index">
                            <section class="premade-parties-wrapper container">
                                <div id="premade-parties-list" class="premade-parties-list">
                                    <div class="streamLobbyItem">
                                        <div class="streamLobbyItemVideo">
                                            <div class="logo-vdo">
                                                <div class="d-flex mx-3 vdo-block">
                                                    <div>
                                                        <h4 class="text-white mt-3 vdo-h1">{{ getDisplayItem(item).gameName }}</h4>
                                                        <!-- <p class="text-white vdo-p">A fun battle by Fortnite Official
                                                            Game
                                                            Corp.</p> -->
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="streamLobbyItemVideoCover">
                                                <div class="video-container" style="width: 100%" *ngIf="getDisplayItem(item).embedUrl">
                                                    <iframe height="400" width="100%" [src]="getDisplayItem(item).embedUrl"
                                                        title="YouTube video player" frameborder="0"
                                                        referrerpolicy="strict-origin-when-cross-origin" frameborder="0"
                                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                                        allowfullscreen></iframe>
                                                </div>
                                                <div class="video-container" style="width: 100%" *ngIf="!getDisplayItem(item).embedUrl">
                                                    <iframe height="400" width="100%" [src]="fallbackVideoUrl"
                                                        title="YouTube video player" frameborder="0"
                                                        referrerpolicy="strict-origin-when-cross-origin" frameborder="0"
                                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                                        allowfullscreen></iframe>
                                                </div>
                                            </div>
                                        </div>

                                    </div>


                                    <div class="streamLobbyItemInfoWrapper">

                                        <div>
                                            <div class="d-flex justify-content-between opac-bg">
                                                <div class="p-4">
                                                    <h1 class="text-light h1-font">
                                                        {{ getDisplayItem(item).name }}
                                                        <svg width="17" height="17" viewBox="0 0 17 17" fill="none"
                                                            xmlns="http://www.w3.org/2000/svg">
                                                            <g clip-path="url(#clip0_5344_406)">
                                                                <path
                                                                    d="M16.5 8.33203C16.5 3.91375 12.9183 0.332031 8.5 0.332031C4.08172 0.332031 0.5 3.91375 0.5 8.33203C0.5 12.7503 4.08172 16.332 8.5 16.332C12.9183 16.332 16.5 12.7503 16.5 8.33203Z"
                                                                    fill="url(#paint0_linear_5344_406)" />
                                                                <path
                                                                    d="M10.1519 7.39482L8.55719 5.05148C8.5509 5.04225 8.54245 5.03469 8.53257 5.02946C8.5227 5.02424 8.5117 5.0215 8.50052 5.02148C8.4894 5.02149 8.47844 5.02423 8.46862 5.02946C8.4588 5.0347 8.45041 5.04226 8.44419 5.05148L6.84952 7.39482C6.8449 7.40164 6.83798 7.40657 6.83003 7.40871C6.82207 7.41085 6.81361 7.41006 6.80619 7.40648L4.32386 6.16815C4.31274 6.16257 4.3003 6.16015 4.2879 6.16115C4.2755 6.16215 4.26361 6.16653 4.25352 6.17382C4.24333 6.1812 4.23532 6.1912 4.23034 6.20276C4.22535 6.21432 4.22357 6.227 4.22519 6.23948L4.76319 10.9128C4.80286 11.3168 6.46086 11.6422 8.50019 11.6422C10.5399 11.6422 12.1979 11.3168 12.2375 10.9128L12.7759 6.23948C12.7774 6.22709 12.7756 6.2145 12.7707 6.20302C12.7658 6.19154 12.7579 6.18157 12.7479 6.17415C12.7378 6.16687 12.726 6.16247 12.7137 6.16141C12.7014 6.16035 12.689 6.16268 12.6779 6.16815L10.1952 7.40482C10.188 7.40863 10.1796 7.40972 10.1717 7.40788C10.1637 7.40605 10.1567 7.40141 10.1519 7.39482Z"
                                                                    fill="white" />
                                                            </g>
                                                            <defs>
                                                                <linearGradient id="paint0_linear_5344_406" x1="15.708"
                                                                    y1="14.1194" x2="-2.09236" y2="6.05188"
                                                                    gradientUnits="userSpaceOnUse">
                                                                    <stop stop-color="#41067A" />
                                                                    <stop offset="0.859293" stop-color="#7A06D1" />
                                                                </linearGradient>
                                                                <clipPath id="clip0_5344_406">
                                                                    <rect width="16" height="16" fill="white"
                                                                        transform="translate(0.5 0.332031)" />
                                                                </clipPath>
                                                            </defs>
                                                        </svg>
                                                    </h1>
                                                    <p class="text-color-light pb-4">
                                                        {{ getDisplayItem(item).serverDescription | truncate: 100 }}
                                                        <br /><span class="opacity-5">
                                                            {{ getDisplayItem(item).description | truncate: 100 }}
                                                        </span>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row premade-card">
                                            <div class="col-lg-3 col-xs-12" *ngFor="let user of getDisplayItem(item).slots">
                                                <div class="d-flex justify-content-center fj">
                                                    <div class="streamLobbyItemProSlotWrapper swiper-slide"
                                                        aria-label="1 / 3"
                                                        style="height: 250px !important; margin-bottom: 20px">
                                                        <img class="card-img-top rounded-circle mobc" style="
                                position: absolute;
                                top: -27px;
                                left: 120px;
                                width: 70px;
                                height: 70px;
                                background-color: #333333;
                                padding: 5px;
                                object-fit: cover;
                              " src="{{ user.profileImageUrl ? user.profileImageUrl : '/assets/images/nouser.png' }}"
                                                            alt="avatar" />
                                                        <div class="container p-3"
                                                            *ngIf="user.username && user.type == 'PRO'">
                                                            <div class="d-flex-justify-content-start">
                                                                <h3 class="text-center text-light h1-font">
                                                                    {{ user.username | truncate: 8 }}
                                                                    <svg width="17" height="17" viewBox="0 0 17 17"
                                                                        fill="none" xmlns="http://www.w3.org/2000/svg">
                                                                        <g clip-path="url(#clip0_5344_406)">
                                                                            <path
                                                                                d="M16.5 8.33203C16.5 3.91375 12.9183 0.332031 8.5 0.332031C4.08172 0.332031 0.5 3.91375 0.5 8.33203C0.5 12.7503 4.08172 16.332 8.5 16.332C12.9183 16.332 16.5 12.7503 16.5 8.33203Z"
                                                                                fill="url(#paint0_linear_5344_406)" />
                                                                            <path
                                                                                d="M10.1519 7.39482L8.55719 5.05148C8.5509 5.04225 8.54245 5.03469 8.53257 5.02946C8.5227 5.02424 8.5117 5.0215 8.50052 5.02148C8.4894 5.02149 8.47844 5.02423 8.46862 5.02946C8.4588 5.0347 8.45041 5.04226 8.44419 5.05148L6.84952 7.39482C6.8449 7.40164 6.83798 7.40657 6.83003 7.40871C6.82207 7.41085 6.81361 7.41006 6.80619 7.40648L4.32386 6.16815C4.31274 6.16257 4.3003 6.16015 4.2879 6.16115C4.2755 6.16215 4.26361 6.16653 4.25352 6.17382C4.24333 6.1812 4.23532 6.1912 4.23034 6.20276C4.22535 6.21432 4.22357 6.227 4.22519 6.23948L4.76319 10.9128C4.80286 11.3168 6.46086 11.6422 8.50019 11.6422C10.5399 11.6422 12.1979 11.3168 12.2375 10.9128L12.7759 6.23948C12.7774 6.22709 12.7756 6.2145 12.7707 6.20302C12.7658 6.19154 12.7579 6.18157 12.7479 6.17415C12.7378 6.16687 12.726 6.16247 12.7137 6.16141C12.7014 6.16035 12.689 6.16268 12.6779 6.16815L10.1952 7.40482C10.188 7.40863 10.1796 7.40972 10.1717 7.40788C10.1637 7.40605 10.1567 7.40141 10.1519 7.39482Z"
                                                                                fill="white" />
                                                                        </g>
                                                                        <defs>
                                                                            <linearGradient id="paint0_linear_5344_406"
                                                                                x1="15.708" y1="14.1194" x2="-2.09236"
                                                                                y2="6.05188"
                                                                                gradientUnits="userSpaceOnUse">
                                                                                <stop stop-color="#41067A" />
                                                                                <stop offset="0.859293"
                                                                                    stop-color="#7A06D1" />
                                                                            </linearGradient>
                                                                            <clipPath id="clip0_5344_406">
                                                                                <rect width="16" height="16"
                                                                                    fill="white"
                                                                                    transform="translate(0.5 0.332031)" />
                                                                            </clipPath>
                                                                        </defs>
                                                                    </svg>
                                                                </h3>

                                                                <p class="text-color-light mt-2">
                                                                    {{ user.summary | truncate: 50 }}
                                                                </p>
                                                            </div>
                                                            <div class="streamLobbySlotTagsWrapper mt-3">
                                                                <div class="streamLobbySlotTag p-2">
                                                                    <span class="red-letter me-2">Country</span>
                                                                    <span class="">{{ user?.region }}</span>
                                                                </div>
                                                                <div class="streamLobbySlotTag p-2">
                                                                    <span class="red-letter me-2">KD</span>
                                                                    <span class="">{{ user.kd }}</span>
                                                                </div>
                                                                <div class="streamLobbySlotTag p-2">
                                                                    <span class="red-letter me-2">Platform</span>
                                                                    <span class="">{{ user.orderCount }}</span>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="streamLobbySlotTag m-auto p-2"
                                                            *ngIf="user.username && user.type === 'CLIENT'">
                                                            <span class="red-letter">Occupied</span>
                                                        </div>
                                                        <div class="streamLobbySlotTag m-auto p-2"
                                                            *ngIf="!user.username">
                                                            <span class="red-letter">Free Slot</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <div class="session-text my-auto mb-4 pb-4">
                                <button type="button" class="btn btn-primary-gg p-3" *ngIf="item.type === 'party'" (click)="joinParty(item.party!.id)">
                                    <h5 class="pe-4 px-4 mb-0">Join the party <span class="h1-font">$ 12/1</span> hour
                                    </h5>
                                </button>
                                <button type="button" class="btn btn-primary-gg p-3" *ngIf="item.type === 'stream' && !isStreamFull(item)" (click)="joinStream(item.stream!.id)">
                                    <h5 class="pe-4 px-4 mb-0">Join the stream <span class="h1-font">$ {{ item.stream?.amount ?? '12' }}/1</span> hour
                                    </h5>
                                </button>
                                <button type="button" class="btn btn-primary-gg p-3" *ngIf="item.type === 'stream' && isStreamFull(item)" (click)="joinStreamWaitlist(item.stream!.id)">
                                    <h5 class="pe-4 px-4 mb-0">Join waitlist <span class="h1-font">$ {{ item.stream?.amount ?? '12' }}/1</span> hour</h5>
                                </button>
                            </div>
                        </div>

                    </ng-container>

                </div>
            </div>
        </div>
    </div>
</main>